<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student List | SmartBite</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="buy_products.css">
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js"></script>
  <script src="firebase_conn.js" type="module"></script>
  <script src="student_list.js" type="module"></script>
  <script type="module" src="role_access.js"></script>

  <style>
    .selected {
      border-right-style: solid;
      border-right-width: 6px;
      border-right-color: #2563eb;
    }

    /* Sidebar transition */
    #sidebar {
      transition: all 0.3s ease;
    }

    .sidebar-collapsed {
      width: 70px !important;
    }

    .sidebar-collapsed .menu-text,
    .sidebar-collapsed .logo-text {
      display: none;
    }

    .sidebar-collapsed .menu-item {
      justify-content: center;
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }

    .sidebar-collapsed .toggle-btn {
      transform: rotate(180deg);
    }

    .main-expanded {
      margin-left: 70px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      transition: all 0.2s ease;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      color: #d1d5db;
      text-decoration: none;
    }

    .menu-item:hover {
      background-color: rgba(59, 130, 246, 0.1);
      transform: translateX(2px);
    }

    .menu-item.active {
      background-color: rgba(59, 130, 246, 0.2);
      color: #3b82f6;
    }
  </style>
</head>
<body class="bg-white flex min-h-screen">
  
  <!-- Sidebar -->
  <aside id="sidebar" class="bg-slate-900 w-64 min-h-screen flex flex-col shadow-lg relative">
    <!-- Toggle Button -->
    <div class="absolute -right-3 top-6 z-10">
      <button id="sidebarToggle" class="bg-slate-800 text-white p-2 rounded-full shadow-md hover:bg-slate-700 transition-colors toggle-btn">
        <i class="fas fa-chevron-left text-sm"></i>
      </button>
    </div>
    
    <!-- Logo Section -->
    <div class="bg-slate-800 p-4 flex items-center justify-center space-x-3">
      <i class="fas fa-wallet text-2xl text-blue-500"></i>
      <h1 class="text-xl font-bold text-white logo-text">SmartBite</h1>
    </div>

    <!-- Navigation Menu -->
    <nav class="flex-1 py-4 overflow-y-auto">
      <ul class="space-y-1 px-2">
        <li>
          <a href="index.html" class="menu-item text-gray-300 flex items-center" data-page="index.html">
            <i class="fas fa-credit-card w-6 text-center"></i>
            <span class="ml-3 menu-text">Register RFID</span>
          </a>
        </li>
        <li>
          <a href="load_rfid.html" class="menu-item text-gray-300 flex items-center" data-page="load_rfid.html">
            <i class="fas fa-wallet w-6 text-center"></i>
            <span class="ml-3 menu-text">Load Card</span>
          </a>
        </li>
        <li>
          <a href="return_money.html" class="menu-item text-gray-300 flex items-center" data-page="return_money.html">
            <i class="fas fa-money-bill-wave w-6 text-center"></i>
            <span class="ml-3 menu-text">Withdraw Money</span>
          </a>
        </li>
        <li>
          <a href="products.html" class="menu-item text-gray-300 flex items-center" data-page="products.html">
            <i class="fas fa-box w-6 text-center"></i>
            <span class="ml-3 menu-text">Add Product</span>
          </a>
        </li>
        <li>
          <a href="https://websocket-testing-3tpu.onrender.com/buy_products.html" class="menu-item text-gray-300 flex items-center" data-page="buy_products.html">
            <i class="fas fa-shopping-cart w-6 text-center"></i>
            <span class="ml-3 menu-text">Buy Product</span>
          </a>
        </li>
        <li>
          <a href="sales.html" class="menu-item text-gray-300 flex items-center" data-page="sales.html">
            <i class="fas fa-chart-line w-6 text-center"></i>
            <span class="ml-3 menu-text">Sales</span>
          </a>
        </li>
        <li>
          <a href="logs.html" class="menu-item text-gray-300 flex items-center" data-page="logs.html">
            <i class="fas fa-clipboard-list w-6 text-center"></i>
            <span class="ml-3 menu-text">Logs</span>
          </a>
        </li>
        <li>
          <a href="add_role.html" class="menu-item text-gray-300 flex items-center" data-page="add_role.html">
            <i class="fas fa-user-plus w-6 text-center"></i>
            <span class="ml-3 menu-text">Role Management</span>
          </a>
        </li>
        <li>
          <a href="student_list.html" class="menu-item text-gray-300 flex items-center active" data-page="student_list.html">
            <i class="fas fa-users w-6 text-center"></i>
            <span class="ml-3 menu-text">Student List</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Logout button at the bottom -->
    <div class="p-4 border-t border-slate-700">
      <button id="logoutBtn" class="w-full flex items-center justify-center px-4 py-2 text-white bg-red-500 hover:bg-red-600 rounded-lg transition">
        <i class="fas fa-sign-out-alt mr-2"></i>
        <span class="menu-text">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Student list -->
  <section id="mainContent" class="flex-1 flex flex-col items-center justify-start bg-gray-100 p-8 relative w-full transition-all duration-300">
    <div class="w-full max-w-6xl">
      <h2 class="text-3xl font-extrabold text-gray-800 mb-6 flex items-center space-x-3">
        <i class="fas fa-users text-blue-600"></i>
        <span>Student Users</span>
      </h2>

      <!-- Search + Sort Controls -->
      <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-3">
        <div class="flex items-center gap-2">
          <input 
            type="text" 
            id="studentSearch" 
            placeholder="ðŸ” Search by ID or Name"
            class="border border-gray-300 rounded-lg px-4 py-2 w-72 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"
          >
          <button id="clearSearch" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg shadow">
            Clear
          </button>
        </div>
        <div class="flex items-center gap-2">
          <label for="balanceSort" class="text-gray-700 font-medium">Sort by Balance:</label>
          <select id="balanceSort" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400">
            <option value="default">Default</option>
            <option value="highToLow">Highest to Lowest</option>
            <option value="lowToHigh">Lowest to Highest</option>
          </select>
        </div>
      </div>

      <!-- Table -->
      <div id="students_container" class="bg-white shadow-xl rounded-xl overflow-hidden border border-gray-200">
        <table class="w-full table-auto text-left border-collapse">
          <thead class="bg-slate-800 text-white text-sm uppercase tracking-wide">
            <tr>
              <th class="px-4 py-3 cursor-pointer hover:bg-slate-700 transition" data-sort="id_number">ID Number</th>
              <th class="px-4 py-3 cursor-pointer hover:bg-slate-700 transition" data-sort="name">Name</th>
              <th class="px-4 py-3 cursor-pointer hover:bg-slate-700 transition" data-sort="balance">Balance</th>
              <th class="px-4 py-3 cursor-pointer hover:bg-slate-700 transition" data-sort="status">Status</th>
              <th class="px-4 py-3 text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="student_table_body" class="text-gray-700 text-sm"></tbody>
        </table>
      </div>

      <!-- Pagination Container (Dynamically Generated) -->
      <div id="paginationContainer"></div>
    </div>
  </section>

  <!-- Edit Modal -->
  <div id="editStudentModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6">
      <h3 class="text-2xl font-bold mb-4 text-gray-800">Edit Student</h3>
      <p id="studentInfo" class="mb-4 text-gray-600">Update student details below:</p>
      
      <form id="editStudentForm" class="space-y-4">
        <input type="hidden" id="editStudentKey">
        
        <div>
          <label class="block text-gray-700 font-semibold mb-1">ID Number <span class="text-red-500">*</span></label>
          <input 
            type="text" 
            id="editIdNumber" 
            maxlength="10"
            class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition"
            placeholder="Max 10 digits, numbers only"
          >
          <p class="text-xs text-gray-500 mt-1">Only numeric digits allowed (max 10)</p>
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">First Name</label>
          <input type="text" id="editFirstName" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">Last Name</label>
          <input type="text" id="editLastName" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
        </div>
        <div class="relative">
          <label class="block text-gray-700 font-semibold mb-1">Balance</label>
          <i class="fas fa-wallet absolute left-4 top-11 text-gray-400"></i>
          <input id="editBalance" type="number" 
            class="p-4 pl-12 text-lg border border-gray-300 rounded-xl w-full focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition" 
            readonly>
        </div>
      </form>

      <div class="flex justify-between mt-6">
        <button id="deleteStudentBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg shadow">Delete</button>
        <div class="space-x-2">
          <button id="saveStudentBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow">Save</button>
          <button id="closeModalBtn" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg shadow">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div id="deleteConfirmModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-sm p-6 text-center">
      <h3 class="text-lg font-bold mb-4">Are you sure?</h3>
      <p id="deleteStudentName" class="mb-6 text-gray-600">This action cannot be undone.</p>
      <div class="flex justify-center space-x-3">
        <button id="confirmDeleteBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg shadow">Delete</button>
        <button id="cancelDeleteBtn" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg shadow">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Disable Confirmation Modal -->
  <div id="disableConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-96 p-6">
      <h2 class="text-lg font-semibold mb-4">Confirm Action</h2>
      <p id="disableStudentName" class="mb-6 text-gray-700">
        Are you sure you want to disable this student?
      </p>
      <div class="flex justify-end space-x-3">
        <button id="cancelDisableBtn" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">
          Cancel
        </button>
        <button id="confirmDisableBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
          Disable
        </button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="hidden fixed bottom-5 right-5 bg-green-500 text-white px-4 py-3 rounded-lg shadow-xl z-[9999]">
    <span id="toastMessage">Success!</span>
  </div>

  <script>
    // Sidebar toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');
      const toggleBtn = document.getElementById('sidebarToggle');
      const menuItems = document.querySelectorAll('.menu-item');
      
      // Set active menu item based on current page
      const currentPage = window.location.pathname.split('/').pop();
      menuItems.forEach(item => {
        if (item.getAttribute('data-page') === currentPage) {
          item.classList.add('active');
        }
      });
      
      // Toggle sidebar
      toggleBtn.addEventListener('click', function() {
        sidebar.classList.toggle('sidebar-collapsed');
        mainContent.classList.toggle('main-expanded');
        
        // Change toggle button icon
        const icon = toggleBtn.querySelector('i');
        if (sidebar.classList.contains('sidebar-collapsed')) {
          icon.classList.remove('fa-chevron-left');
          icon.classList.add('fa-chevron-right');
        } else {
          icon.classList.remove('fa-chevron-right');
          icon.classList.add('fa-chevron-left');
        }
      });
      
      // Logout functionality
      document.getElementById('logoutBtn').addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
          localStorage.removeItem('cashierUser');
          window.location.href = 'index.html';
        }
      });
    });
  </script>
</body>

</html>

